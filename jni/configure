#!/bin/bash

# Set different archs separated by comma
#archlist=i386-softmmu
#archlist=$archlist,x86_64-softmmu
archlist=x86_64-softmmu

configdevice=$(cat android-device-config.mak | grep -v ^# | sed '/^$/d' | grep include | cut -d' ' -f2)
configndk=android-toolchain.mak
ndkbase=$(cat $configndk | grep NDK_BASE= | cut -d'=' -f2)
ndkplatform=$(cat $configndk | grep NDK_PLATFORM= | cut -d'=' -f2)
usrinclude=$(cat $configndk | grep NDK_INCLUDE= | cut -d'=' -f2)
toolchaindir=$(cat $configndk | grep TOOLCHAIN_DIR= | cut -d'=' -f2)
gccprefix=$(cat $configndk | grep GCC_PREFIX= | cut -d'=' -f2)
echo CONFIG DEVICE: $configdevice
echo CONFIG NDK: $configndk
echo TOOLCHAIN DIR: $toolchaindir
echo NDK BASE: $ndkbase
echo NDK PLATFORM: $ndkplatform
echo USR INCLUDE: $usrinclude
cd ./qemu
./configure --disable-kvm --disable-curses --target-list=$archlist \
--disable-vhost-net --disable-spice --disable-smartcard-nss --disable-uuid \
--disable-vnc-jpeg  --disable-vnc-png --enable-vnc-thread --disable-attr \
--disable-linux-aio --disable-pie --disable-smartcard --disable-smartcard-nss \
--disable-nptl --disable-opengl --disable-zlib-test --with-coroutine=gthread \
--audio-card-list= --audio-drv-list= \
--disable-guest-agent --android --less-warnings --cpu=armv4b \
--cross-prefix=$toolchaindir/bin/arm-linux-androideabi- \
--extra-cflags=" -I$ndkbase/$ndkplatform/$usrinclude -I../limbo/include -I../glib/glib -I../glib -I../glib/gmodule -I../glib/io -I../limbo/include -I../../glib/glib -I../../glib -I../../glib/gmodule -I../../glib/io -I../SDL/include" 

#--enable-sdl

#ln -sf ../android-device-config ./i386-softmmu/android-device-config
ln -sf ../android-device-config ./x86_64-softmmu/android-device-config
ln -sf ../android-device-config ./android-device-config
cd libdis
ln -sf ../../android-device-config android-device-config
cd ..
cd libdis-user
ln -sf ../../android-device-config android-device-config
cd ..
cd libhw32
ln -sf ../../android-device-config android-device-config
cd ..
cd libhw64
ln -sf ../../android-device-config android-device-config
cd ..
